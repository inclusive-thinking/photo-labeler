@using PhotoLabeler.Components.Extensions;

@if (!string.IsNullOrWhiteSpace(Cell.Link))
{
    <a href="@Cell.Link" 
    @onkeydown="Item_KeyDown" 
    tabindex="@( Cell.Selected?"0":"-1")"
    >
        @Cell.Text
    </a>
}
else
{
    <span tabindex="@( Cell.Selected?"0":"-1")">
        @Cell.Text
    </span>
}

@code
{
    [Parameter] public Entities.Grid.GridCell Cell { get; set; }
    [Parameter] public RenderFragment fragment { get; set; }

    private void Item_KeyDown(Microsoft.AspNetCore.Components.Web.KeyboardEventArgs e)
    {
        // focusOnItemAfterRender = false;
        Entities.Grid.GridCell newSelectedCell = null;

        switch (e.Key)
        {
            case "ArrowLeft":
                if (Cell.CellIndex == 0)
                {
                    return;
                }
                newSelectedCell = Cell.Row.Cells[Cell.CellIndex - 1];
                break;
            case "ArrowRight":
                if (Cell.CellIndex == Cell.Row.Cells.Count - 1)
                {
                    return;
                }
                newSelectedCell = Cell.Row.Cells[Cell.CellIndex + 1];
                break;
            case "ArrowUp":
                var previousRow = Cell.Row.GetPreviousRow();
                if (previousRow == null)
                {
                    return;
                }
                newSelectedCell = previousRow.Cells[Cell.CellIndex];
                break;
            case "ArrowDown":
                var nextRow = Cell.Row.GetNextRow();
                if (nextRow == null)
                {
                    return;
                }
                newSelectedCell = nextRow.Cells[Cell.CellIndex];
                break;
            default:
                break;
        }
        if (newSelectedCell != null)
        {
            newSelectedCell.Selected = true;
            Cell.Selected = false;
            // focusOnItemAfterRender = true;
        }
    }

}


